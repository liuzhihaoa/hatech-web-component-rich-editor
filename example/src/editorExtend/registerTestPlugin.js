/**
 * 注册编辑器插件
 * 此处演示弹框与编辑器的交互
 * @param _self -- 页面vue实例
 * @param editorManager -- 编辑器工具管理器
 */

export default function registerTestPlugin(_self, editorManager) {
  /**
   * 注册插件
   */
  editorManager.PluginManager.add('testPlugin', function (editor, url) {
    console.log(url);

    const pluginName = '测试按钮';

    // 注册一个自定义图标
    editor.ui.registry.addIcon('testPluginIcon', '<svg style="width: 20px; height: 20px" t="1602750290364" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2998" width="200" height="200"><path d="M129.194667 376.32c-83.029333 132.5056-43.2128 305.2032 77.499733 433.8176 109.687467 116.872533 289.28 159.470933 443.4432 106.205867 158.72-54.869333 268.288-198.434133 274.363733-361.028267 8.669867-138.359467-67.157333-274.432-207.496533-288.8192-52.650667-5.393067-101.12 5.4272-148.6848 27.648l-8.925867 4.317867-7.168 3.703466c-7.594667 4.0448-16.264533 8.874667-23.517866 12.970667l-13.687467 7.7824-20.8896-8.942933a665.0368 665.0368 0 0 1-12.561067-5.563734l-27.528533-12.629333c-37.205333-16.896-57.685333-24.2688-84.599467-28.962133-100.522667-17.4592-189.1328 27.938133-240.264533 109.499733z m228.5568-42.24c19.712 3.4304 36.352 9.437867 68.590933 24.081067l27.1872 12.4928 7.1168 3.191466 29.3888 12.6464 2.781867 1.2288c9.216 4.096 14.592 5.768533 23.466666 5.5296 5.256533-0.1536 9.710933-1.143467 14.4384-2.798933l5.12-1.962667 2.269867-0.9216c6.0928-2.423467 41.130667-22.818133 53.486933-28.8768 39.202133-19.234133 77.636267-28.4672 118.442667-24.285866 95.300267 9.762133 151.125333 107.298133 146.568533 212.241066l-0.290133 5.256534c-5.051733 134.912-96.017067 254.122667-228.488533 299.912533-128.955733 44.561067-280.251733 8.686933-371.370667-88.405333C155.0336 655.342933 122.709333 515.242667 187.050667 412.586667c36.181333-57.736533 96.0512-89.361067 165.495466-79.3088l5.2224 0.8192z" fill="#444444" p-id="2999"></path><path d="M618.5984 100.283733c52.5824-29.149867 120.576-41.8304 140.578133-21.162666a34.133333 34.133333 0 0 1 8.4992 15.104c1.245867 4.7616 2.901333 12.356267 4.573867 22.254933l0.631467 3.822933c6.1952 38.741333 7.2704 79.4112-0.170667 118.408534a224.733867 224.733867 0 0 1-15.291733 49.5616 34.133333 34.133333 0 1 1-62.344534-27.818667 156.962133 156.962133 0 0 0 10.581334-34.56c4.778667-25.070933 4.9664-52.2752 1.979733-78.916267l-0.938667-7.509333-2.952533 0.6144c-14.882133 3.345067-30.344533 8.738133-45.568 16.452267l-6.485333 3.464533c-55.586133 30.788267-96.529067 86.664533-114.176 176.213333a34.133333 34.133333 0 0 1-66.986667-13.192533c21.572267-109.346133 74.922667-182.2208 148.0704-222.737067z" fill="#444444" p-id="3000"></path><path d="M290.133333 460.8a34.133333 34.133333 0 0 1 33.792 38.912l0.580267 0.034133c-2.5088 51.2512 15.035733 103.3216 47.786667 142.1312l3.857066 4.437334-50.807466 45.602133c-45.755733-50.978133-70.843733-119.790933-69.2736-188.6208l0.136533-4.522667A34.133333 34.133333 0 0 1 290.133333 460.8z" fill="#00B386" p-id="3001"></path></svg>');

    // 注册菜单栏按钮 -- 用于在菜单按钮上显示
    editor.ui.registry.addMenuItem('testPlugin', {
      icon: 'testPluginIcon',
      text: pluginName,
      tooltip: pluginName,
      onAction: function () {
        // 此处调用在Vue Created钩子函数里注册到编辑器的响应事件
        editorManager.execCommand('handleTestPluginClick');

        // 当然也可以直接操作 同样的效果
        // _self.visible = true;
      }
    });

    // 注册一个工具栏按钮名称 -- 用于在工具栏上显示
    editor.ui.registry.addButton('testPlugin', {
      icon: 'testPluginIcon',
      tooltip: pluginName,
      onAction: function () {
        // 此处调用在Vue Created钩子函数里注册到编辑器的响应事件
        editorManager.execCommand('handleTestPluginClick');

        // 当然也可以直接操作 同样的效果
        // _self.visible = true;
      }
    });

    // 注册编辑器响应事件

    /**
     * 工具栏图标点击响应事件
     */
    editor.editorCommands.addCommand('handleTestPluginClick', () => {
      _self.visible = true;
    });

    /**
     * 测试弹框关闭响应事件
     */
    editor.editorCommands.addCommand('handleDialogClose', () => {
      // 创建一个节点
      const ele = editor.dom.create('p', {
        style: 'color: rgb(186, 55, 42)'
      }, '测试文本');
      // 将新建的节点追加到编辑器中
      editor.selection.setNode(ele);
      _self.visible = false;
    });

  });

}